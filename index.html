<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Analizzatore Gold Pro - Global 2025</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #2d2d2d; }
        th, td { padding: 12px; border: 1px solid #444; text-align: left; }
        th { background: #d4a017; color: #000; }
        .future { background: #2ecc71; padding: 5px 10px; border-radius: 4px; font-weight: bold; color: white; }
        #orario-attuale { font-weight: bold; color: #d4a017; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>üèÜ Analizzatore Gold (Global 2025 - All Leagues)</h2>
    <div id="orario-attuale"></div>
    
    <textarea id="palinsesto" placeholder="Incolla qui il palinsesto..." style="width:100%; height:150px; background:#333; color:#fff; border: 1px solid #d4a017;"></textarea>
    <br><br>
    <button onclick="processaGold()" style="padding:15px 30px; cursor:pointer; background:#d4a017; border:none; font-weight:bold; color:#000; border-radius:5px;">GENERA SCHEDINA GOLD</button>

    <div id="risultati">
        <table>
            <thead>
                <tr>
                    <th>Ora</th>
                    <th>Match</th>
                    <th>Target</th>
                    <th>Probabilit√†</th>
                    <th>Stato</th>
                </tr>
            </thead>
            <tbody id="match-body"></tbody>
        </table>
    </div>

    <script>
        // DATABASE GLOBALE 2025 INTEGRATO
        const globalDB = {
            "Roma": { "prob": 0.93, "target": "U3.5" },
            "Egitto": { "prob": 0.90, "target": "U2.5" },
            "Marocco": { "prob": 0.89, "target": "U2.5" },
            "Oran": { "prob": 0.88, "target": "U2.5" },
            "MC Alger": { "prob": 0.88, "target": "U2.5" },
            "Melbourne Victory": { "prob": 0.87, "target": "O2.5" },
            "Al-Taawon": { "prob": 0.86, "target": "U3.5" }
        };

        function processaGold() {
            const rawData = document.getElementById('palinsesto').value;
            const adesso = new Date();
            const body = document.getElementById('match-body');
            body.innerHTML = '';

            // LOGICA DI ESTRAZIONE CORRETTA
            const linee = rawData.split('\n');
            let matches = [];

            linee.forEach(linea => {
                // Regex per estrarre Ora e Squadre (es: "29.12 20:45" o "20:45")
                const oraMatch = linea.match(/(\d{2}:\d{2})/);
                if (oraMatch) {
                    const ora = oraMatch[1];
                    // Pulisce il nome della squadra togliendo date e orari
                    const squadra = linea.split(':')[1] ? linea.split(':')[0].split(',')[0].replace(/\d{2}\.\d{2}/, '').trim() : linea.split(',')[0].trim();
                    matches.push({ ora, squadra: squadra.split(' vs ')[0].split(' - ')[0].trim() });
                }
            });

            // FILTRO TEMPORALE + PROBABILIT√Ä
            const validi = matches.filter(m => {
                const [h, min] = m.ora.split(':');
                const d = new Date();
                d.setHours(parseInt(h), parseInt(min), 0);
                return d > new Date(adesso.getTime() + 5 * 60000); // +5 min
            }).sort((a, b) => (globalDB[b.squadra]?.prob || 0.70) - (globalDB[a.squadra]?.prob || 0.70));

            validi.forEach(m => {
                // Cerca nel DB o applica filtro base 2025
                const info = Object.keys(globalDB).find(k => m.squadra.includes(k)) ? globalDB[Object.keys(globalDB).find(k => m.squadra.includes(k))] : { prob: 0.75, target: "U3.5" };
                
                body.innerHTML += `<tr>
                    <td>${m.ora}</td>
                    <td>${m.squadra}</td>
                    <td>${info.target}</td>
                    <td>${(info.prob * 100).toFixed(0)}%</td>
                    <td><span class="future">DISPONIBILE</span></td>
                </tr>`;
            });
        }

        setInterval(() => {
            document.getElementById('orario-attuale').innerText = "Orario Sistema: " + new Date().toLocaleTimeString();
        }, 1000);
    </script>
</body>
</html>
